<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tournament Brackets - View | Uni Games</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


  <style>
    :root {
      --primary-color: #0f85d3;
      --bg-dark: #0D0A1A;
      --accent-secondary: #5D3FD3;
      --panel: #161329;
      --text-primary: #F0F0F0;
      --text-secondary: rgba(240, 240, 240, 0.7);
      --border-color: rgba(10, 250, 217, 0.2);
      --ease: 0.3s ease;
      --radius: 12px;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      padding-top: 60px;
      /* Account for fixed navbar */
    }
    
   /* =========================MODERN NAVBAR STYLES========================= */
    .nav-normal {
        background: rgba(13, 10, 26, 0.1);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        padding: 0.5rem 2rem;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        transition: transform 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        transform: translateY(0);
    }

    .nav-normal.nav-hidden {
        transform: translateY(-100%);
    }

    .nav-normal.nav-scrolled {
        background: rgba(13, 10, 26, 0.3);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
    }

    .nav-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1400px;
        margin: 0 auto;
    }

    .logo {
        font-size: 1.5rem;
        font-weight: 700;
        color: white;
        text-decoration: none;
        letter-spacing: -0.5px;
        display: flex;
        align-items: center;
    }

    .logo img {
        height: 80px;
        width: auto;
        margin: 0;
        padding: 0;
        display: block;
    }

    .nav-center {
        display: flex;
        align-items: center;
        gap: 2.5rem;
    }

    .nav-links {
        display: flex;
        gap: 0;
        list-style: none;
        align-items: center;
        margin: 0;
        padding: 0;
    }

    .nav-links li {
        position: relative;
    }

    .nav-links a {
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        padding: 0.6rem 1.2rem;
        display: block;
    }

    .nav-links a:hover,
    .nav-links a.active {
        color: white;
    }

    .auth-buttons {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .btn {
        padding: 0.6rem 1.2rem;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-request {
        background: linear-gradient(135deg, var(--primary-color), var(--accent-secondary));
        color: white;
    }

    .btn-request:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(15, 133, 211, 0.3);
    }

    .btn-logout {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .btn-logout:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
    }

    #user-menu {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 50px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-secondary) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.85rem;
    }

    .user-name {
        font-weight: 500;
        font-size: 0.9rem;
    }

    .menu-toggle {
        display: none;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.5rem;
    }

    .menu-icon {
        width: 24px;
        height: 20px;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .menu-icon span {
        width: 100%;
        height: 2px;
        background: white;
        border-radius: 2px;
        transition: all 0.3s ease;
    }

    .menu-toggle.active .menu-icon span:nth-child(1) {
        transform: rotate(45deg) translate(7px, 7px);
    }

    .menu-toggle.active .menu-icon span:nth-child(2) {
        opacity: 0;
    }

    .menu-toggle.active .menu-icon span:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -7px);
    }

    /* Mobile Styles */
    @media (max-width: 968px) {
        .menu-toggle {
            display: block;
        }

        .nav-center {
            position: fixed;
            top: 0;
            right: -100%;
            height: 100vh;
            width: 85%;
            max-width: 350px;
            flex-direction: column;
            background: rgba(15, 15, 15, 0.98);
            backdrop-filter: blur(20px);
            padding: 6rem 2rem 2rem;
            gap: 0;
            transition: right 0.3s ease;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            align-items: flex-start;
            overflow-y: auto;
        }

        .nav-center.active {
            right: 0;
        }

        .nav-links {
            flex-direction: column;
            width: 100%;
            gap: 0;
        }

        .nav-links li {
            width: 100%;
        }

        .nav-links a {
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .auth-buttons {
            flex-direction: column;
            width: 100%;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-info {
            width: 100%;
            justify-content: center;
        }

        #user-menu {
            display: flex;
            flex-direction: column;
            width: 100%;
            gap: 1rem;
        }
    }

    @media (max-width: 768px) {
      .hero-section {
        padding: 3rem 1rem;
        margin-bottom: 2rem;
      }

      .hero-title {
        font-size: clamp(2rem, 8vw, 3rem);
      }

      .hero-subtitle {
        font-size: 1.1rem;
      }

      .container {
        padding: 1rem;
      }

      /* On mobile, reduce table padding for better fit */
      .match-table th,
      .match-table td {
        padding: 0.75rem 0.5rem;
        font-size: 0.9rem;
      }

      /* Adjust column widths for mobile */
      .match-table th:nth-child(1),
      .match-table td:nth-child(1),
      .match-table th:nth-child(3),
      .match-table td:nth-child(3) {
        width: 60px;
      }
    }

    .hero-section {
      text-align: center;
      padding: 4rem 0;
      margin-bottom: 3rem;
      background: linear-gradient(135deg, rgba(15, 133, 211, 0.1), rgba(93, 63, 211, 0.1));
      border-radius: var(--radius);
      border: 1px solid var(--border-color);
    }

    .hero-content {
      max-width: 800px;
      margin: 0 auto;
    }

    .hero-title {
      font-size: clamp(2.5rem, 5vw, 4rem);
      font-weight: 800;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--primary-color), var(--accent-secondary));
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      line-height: 1.2;
      letter-spacing: -0.02em;
    }

    .hero-subtitle {
      font-size: 1.25rem;
      color: var(--text-secondary);
      font-weight: 500;
      margin: 0;
      opacity: 0.9;
    }

    .brackets-container {
      background: var(--panel);
      border-radius: var(--radius);
      border: 1px solid var(--border-color);
      padding: 2rem;
      overflow-x: auto;
    }

    .bracket-round {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      min-width: 250px;
      margin-right: 2rem;
    }

    .bracket-match {
      background: rgba(15, 133, 211, 0.1);
      border: 1px solid var(--primary-color);
      border-radius: var(--radius);
      padding: 1rem;
      position: relative;
    }

    .match-teams {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .team {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 6px;
      transition: var(--ease);
    }

    .team.winner {
      background: rgba(40, 167, 69, 0.2);
      border: 1px solid #28a745;
    }

    .team.loser {
      opacity: 0.6;
    }

    .team-name {
      font-weight: 600;
    }

    .team-score {
      font-weight: 700;
      color: var(--primary-color);
    }

    .match-status {
      text-align: center;
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .rounds-container {
      display: flex;
      align-items: flex-start;
      gap: 2rem;
      padding: 1rem 0;
    }

    .round-title {
      text-align: center;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--primary-color);
    }

    .no-brackets {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .loading {
      text-align: center;
      padding: 3rem;
    }

    .back-button {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--primary-color);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      text-decoration: none;
      font-weight: 600;
      transition: var(--ease);
      margin-bottom: 2rem;
    }

    .back-button:hover {
      background: var(--accent-secondary);
      transform: translateY(-2px);
    }

    .format-info {
      background: rgba(93, 63, 211, 0.1);
      border: 1px solid var(--accent-secondary);
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 2rem;
    }

    .participants-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .participant-card {
      background: var(--panel);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      padding: 1rem;
    }

    .participant-card h4 {
      margin: 0 0 0.5rem 0;
      color: var(--primary-color);
    }

    .seed-number {
      background: var(--accent-secondary);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .matches-section {
      margin-top: 3rem;
    }

    .match-table {
      width: 100%;
      background: var(--panel);
      border-radius: var(--radius);
      border: 1px solid var(--border-color);
      margin-bottom: 2rem;
      overflow: hidden;
    }

    .match-table th,
    .match-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .match-table th {
      background: rgba(15, 133, 211, 0.1);
      font-weight: 600;
      color: var(--primary-color);
    }

    .match-table tr:last-child td {
      border-bottom: none;
    }

    .match-table tr:hover {
      background: rgba(255, 255, 255, 0.02);
    }

    .match-number {
      font-weight: 700;
      color: var(--accent-secondary);
    }

    .vs-separator {
      color: var(--text-secondary);
      font-weight: 600;
      margin: 0 0.5rem;
    }

    .status-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-registration-open {
      background: rgba(40, 167, 69, 0.2);
      color: #28a745;
      border: 1px solid #28a745;
    }

    .status-registration-closed {
      background: rgba(255, 193, 7, 0.2);
      color: #ffc107;
      border: 1px solid #ffc107;
    }

    .status-active {
      background: rgba(15, 133, 211, 0.2);
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
    }

    .status-completed {
      background: rgba(108, 117, 125, 0.2);
      color: #6c757d;
      border: 1px solid #6c757d;
    }

    .round-section {
      margin-bottom: 3rem;
    }

    .round-header {
      background: linear-gradient(135deg, var(--primary-color), var(--accent-secondary));
      color: white;
      padding: 1rem 1.5rem;
      border-radius: var(--radius) var(--radius) 0 0;
      font-weight: 700;
      font-size: 1.2rem;
    }



    /* Tournament Brackets Styling */
    .stage-section {
      margin-bottom: 3rem;
    }

    .stage-header {
      background: linear-gradient(135deg, var(--primary-color), var(--accent-secondary));
      color: white;
      padding: 1.5rem;
      border-radius: var(--radius) var(--radius) 0 0;
      margin-bottom: 0;
    }

    .stage-header h4 {
      margin: 0 0 0.5rem 0;
      font-size: 1.3rem;
    }

    .stage-header p {
      margin: 0;
      opacity: 0.9;
    }

    .match-table-container {
      background: var(--panel);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      margin-bottom: 2rem;
      overflow: hidden;
    }

    .match-table-header {
      background: rgba(15, 133, 211, 0.1);
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
    }

    .match-table-header h5 {
      margin: 0;
      color: var(--primary-color);
      font-size: 1.1rem;
    }

    .match-count {
      background: var(--primary-color);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 15px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .match-header-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .match-schedule {
      background: rgba(93, 63, 211, 0.2);
      color: var(--accent-secondary);
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
      font-size: 0.75rem;
      font-weight: 500;
      margin-left: 0.5rem;
    }

    .match-table {
      width: 100%;
      border-collapse: collapse;
    }

    .match-table th,
    .match-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .match-table th {
      background: rgba(0, 0, 0, 0.1);
      font-weight: 600;
      color: var(--text-primary);
    }

    .match-table tr:hover {
      background: rgba(15, 133, 211, 0.05);
    }

    .match-table tr:last-child td {
      border-bottom: none;
    }

    /* Qualifier table 4-column layout styling */
    .match-table th:nth-child(1),
    .match-table td:nth-child(1),
    .match-table th:nth-child(3),
    .match-table td:nth-child(3) {
      width: 80px;
      text-align: center;
    }

    .match-table th:nth-child(2),
    .match-table td:nth-child(2),
    .match-table th:nth-child(4),
    .match-table td:nth-child(4) {
      width: auto;
    }

    /* Add border between the two sections for better visual separation */
    .match-table th:nth-child(2),
    .match-table td:nth-child(2) {
      border-right: 2px solid var(--primary-color);
    }

    .match-number {
      font-weight: 700;
      color: var(--accent-secondary);
      text-align: center;
    }

    .match-teams {
      font-weight: 500;
    }

    .match-status {
      padding: 0.25rem 0.75rem;
      border-radius: 15px;
      font-size: 0.85rem;
      font-weight: 600;
      text-align: center;
      background: rgba(108, 117, 125, 0.2);
      color: #6c757d;
    }

    .match-schedule {
      color: var(--text-secondary);
    }

    

    .qualifier-source {
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-style: italic;
    }

    .finalists-section {
      margin-top: 3rem;
    }

    .finalists-table-container {
      background: var(--panel);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .finalists-table {
      width: 100%;
      border-collapse: collapse;
    }

    .finalists-table th,
    .finalists-table td {
      padding: 1rem;
      text-align: center;
      border-bottom: 1px solid var(--border-color);
    }

    .finalists-table th {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #000;
      font-weight: 700;
    }

    .finalist-rank {
      font-weight: 700;
      color: var(--primary-color);
      font-size: 1.1rem;
    }

    .finalist-team {
      font-weight: 600;
    }

    .finalist-prize {
      font-weight: 600;
      color: var(--accent-secondary);
    }

    .qualifier-carousel {
      position: relative;
      margin-bottom: 2rem;
    }

    .carousel-container {
      overflow: hidden;
      position: relative;
    }

    .carousel-slides {
      display: flex;
      transition: transform 0.3s ease-in-out;
    }

    .carousel-slide {
      min-width: 100%;
      flex-shrink: 0;
    }

    .carousel-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-top: 1rem;
    }

    .carousel-btn {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 600;
      transition: var(--ease);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .carousel-btn:hover:not(:disabled) {
      background: var(--accent-secondary);
      transform: translateY(-2px);
    }

    .carousel-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .carousel-indicator {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 1rem;
    }

    @media (max-width: 768px) {
      /* ... your existing mobile styles ... */

      /* Carousel mobile adjustments */
      .carousel-btn {
        padding: 0.5rem 1rem;
        font-size: 0.85rem;
      }

      .carousel-btn i {
        font-size: 0.75rem;
      }

      .carousel-indicator {
        font-size: 0.85rem;
      }

      .carousel-controls {
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      /* Stage header mobile adjustments */
      .stage-header {
        padding: 1rem;
      }

      .stage-header h4 {
        font-size: 1.1rem;
      }

      .stage-header p {
        font-size: 0.85rem;
      }

      /* Match table header mobile adjustments */
      .match-table-header {
        padding: 0.75rem 1rem;
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .match-table-header h5 {
        font-size: 0.95rem;
      }

      .match-header-controls {
        width: 100%;
        justify-content: space-between;
      }

      .match-count {
        font-size: 0.75rem;
        padding: 0.2rem 0.5rem;
      }

      .match-schedule {
        font-size: 0.65rem;
        padding: 0.15rem 0.4rem;
      }

      /* Brackets container mobile */
      .brackets-container {
        padding: 1rem;
      }

      /* Team names truncation on mobile */
      .match-teams {
        max-width: 150px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
    }

    /* Extra small devices (phones < 480px) */
    @media (max-width: 480px) {
      .carousel-btn {
        padding: 0.4rem 0.75rem;
        font-size: 0.75rem;
      }

      .carousel-btn span {
        display: none; /* Hide "Previous" and "Next" text */
      }

      .carousel-indicator {
        font-size: 0.75rem;
      }

      .match-table th,
      .match-table td {
        padding: 0.5rem 0.25rem;
        font-size: 0.8rem;
      }

      .match-number {
        font-size: 0.75rem;
      }

      .match-teams strong {
        font-size: 0.85rem;
      }

      /* Reduce column widths further */
      .match-table th:nth-child(1),
      .match-table td:nth-child(1),
      .match-table th:nth-child(3),
      .match-table td:nth-child(3) {
        width: 40px;
      }

      .hero-section {
        padding: 2rem 0.5rem;
      }

      .container {
        padding: 0.5rem;
      }

      .brackets-container {
        padding: 0.5rem;
      }
    }

    /* =========================
       Custom Scrollbar Styles
       ========================= */
    ::-webkit-scrollbar-track {
      border-radius: 5px;
      border: 1px solid var(--border-color);
      background-color: var(--bg-dark);
    }

    ::-webkit-scrollbar {
      border-radius: 5px;
      width: 10px;
      background-color: var(--bg-dark);
    }

    ::-webkit-scrollbar-thumb {
      border-radius: 5px;
      background-color: var(--panel);
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb:hover {
      border-radius: 5px;
      background-color: var(--accent-secondary);
    }

    /* Firefox scrollbar */
    html {
      scrollbar-width: thin;
      scrollbar-color: var(--panel) var(--bg-dark);
    }
  </style>
</head>

<body>
  <nav class="nav-normal">
    <div class="nav-container">
        <a href="index.html" class="logo">
            <img src="ug.png" alt="Uni Games">
        </a>
        <div class="nav-center" id="normalNav">
            <ul class="nav-links">
                <li><a href="tournaments.html">Tournaments</a></li>
                <li><a href="tournament-brackets.html" class="active">Brackets</a></li>
            </ul>
            <div class="auth-buttons" id="normalAuth">
                <div id="guest-menu">
                    <a href="auth.html" class="btn btn-request">Join Us</a>
                </div>
                <div id="user-menu" style="display: none;">
                    <div class="user-info">
                        <div class="user-avatar" id="user-avatar">U</div>
                        <span class="user-name" id="navbar-username">User</span>
                    </div>
                    <button class="btn btn-logout" onclick="handleLogout()">Logout</button>
                </div>
            </div>
        </div>
        <button class="menu-toggle" id="normalMenuToggle">
            <div class="menu-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
    </div>
</nav>

  <div id="mobile-nav" class="mobile-nav" hidden>
  </div>

  <div class="container">


    <div class="hero-section">
      <div class="hero-content">
        <h1 class="hero-title" id="tournament-title">Loading Tournament...</h1>
        <p class="hero-subtitle">Tournament Brackets & Match Schedule</p>
      </div>
    </div>

    <div class="brackets-container" id="brackets-container">
      <div class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading tournament brackets...</p>
      </div>
    </div>


  </div>

  <script>
    const API_BASE_URL = 'https://t2-237c.onrender.com';
    let tournamentData = null;
    let matchesData = [];


    // Get tournament slug from URL
    const urlParams = new URLSearchParams(window.location.search);
    const tournamentSlug = urlParams.get('slug');
    console.log('Tournament Slug:', tournamentSlug);

    if (!tournamentSlug) {
      document.getElementById('brackets-container').innerHTML = `
                <div class="no-brackets">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem; color: #ffc107;"></i>
                    <h3>No Tournament Specified</h3>
                    <p>Please select a tournament from the admin dashboard.</p>
                </div>
            `;
    } else {
      loadTournamentBrackets();
    }

    async function loadTournamentBrackets() {
      try {
        // Load tournament data
        const response = await fetch(`${API_BASE_URL}/api/tournaments/slug/${tournamentSlug}`);
        if (!response.ok) {
          throw new Error('Tournament not found');
        }

        const apiResponse = await response.json();
        console.log('API Response:', apiResponse);
        tournamentData = apiResponse.data || apiResponse;
        console.log('Tournament Data:', tournamentData);

        // Update page title and info
        document.getElementById('tournament-title').textContent = tournamentData.title;
        document.title = `${tournamentData.title} - Brackets | Uni Games`;

        // Display tournament info
        displayTournamentInfo();

        // Display brackets based on format
        displayBrackets();

      } catch (error) {
        console.error('Error loading tournament:', error);
        document.getElementById('brackets-container').innerHTML = `
                    <div class="no-brackets">
                        <i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: 1rem; color: #dc3545;"></i>
                        <h3>Error Loading Tournament</h3>
                        <p>${error.message}</p>
                    </div>
                `;
      }
    }

    function getMaxTeamsForDisplay() {
      const format = (tournamentData.format || 'single_elimination').toLowerCase();
      let maxTeams = tournamentData.maxTeams;

      // For KP format, calculate maxTeams from kpSettings if not set
      if (format === 'kp' && tournamentData.kpSettings && !maxTeams) {
        const kpSettings = tournamentData.kpSettings;
        maxTeams = (kpSettings.groupSize || 25) * (kpSettings.numberOfGroups || 4);
      }

      return maxTeams || 'Unlimited';
    }

    function displayTournamentInfo() {
      // Only update the tournament title - all other info cards are removed
      // The title is already updated in loadTournamentBrackets function
    }



    function displayBrackets() {
      const participants = tournamentData.participants || [];
      const container = document.getElementById('brackets-container');

      if (participants.length === 0) {
        container.innerHTML = `
                    <div class="no-brackets">
                        <i class="fas fa-users-slash" style="font-size: 3rem; margin-bottom: 1rem; color: #6c757d;"></i>
                        <h3>No Teams Registered</h3>
                        <p>Brackets will be generated once teams register for this tournament.</p>
                    </div>
                `;
        return;
      }

      const format = (tournamentData.format || 'single_elimination').toLowerCase();

      // Handle all tournament formats dynamically
      displayTournamentBrackets(participants, container, format);
    }

    function displayTournamentBrackets(participants, container, format) {
      const formatConfig = getTournamentFormatConfig(format, participants.length);

      if (!formatConfig) {
        displayParticipantsList(participants, container);
        return;
      }

      let html = ``;

      // Create match tables for each stage
      formatConfig.stages.forEach((stage, stageIndex) => {
        html += `<div class="stage-section">`;
        html += `<div class="stage-header">`;
        html += `<h4><i class="fas fa-trophy"></i> ${stage.name}</h4>`;
        html += `<p>${stage.description}</p>`;
        html += `</div>`;

        // Check if this is qualifier stage for carousel
        if (stage.name.includes('Qualifier')) {
          html += `<div class="qualifier-carousel">`;
          html += `<div class="carousel-container">`;
          html += `<div class="carousel-slides" id="carousel-slides">`;
          
          // Create all qualifier tables as slides
          stage.tables.forEach((table, tableIndex) => {
            html += `<div class="carousel-slide">`;
            html += createMatchTable(table, participants, stageIndex, tableIndex);
            html += `</div>`;
          });
          
          html += `</div></div>`; // Close carousel-slides and carousel-container
          
          // Add navigation controls
          html += `<div class="carousel-controls">`;
          html += `<button class="carousel-btn" id="prev-btn" onclick="previousSlide()" disabled>
                      <i class="fas fa-chevron-left"></i> Previous
                  </button>`;
          html += `<span class="carousel-indicator" id="slide-indicator">Match 1 of ${stage.tables.length}</span>`;
          html += `<button class="carousel-btn" id="next-btn" onclick="nextSlide()">
                      Next <i class="fas fa-chevron-right"></i>
                  </button>`;
          html += `</div>`;
          
          html += `</div>`; // Close qualifier-carousel
        } else {
          // For finalists or other stages, display normally
          stage.tables.forEach((table, tableIndex) => {
            html += createMatchTable(table, participants, stageIndex, tableIndex);
          });
        }

        html += `</div>`;
      });

          container.innerHTML = html;
    }

    function getTournamentFormatConfig(format, participantCount) {
      // Use backend tournament data to generate format configuration
      const formatSettings = tournamentData.kpSettings || {};
      const matchSchedule = formatSettings.matchSchedule || [];

      switch (format) {
        case 'kp':
          return generateKPFormatConfig(formatSettings, matchSchedule, participantCount);
        case 'single_elimination':
          return generateSingleEliminationConfig(participantCount);
        case 'double_elimination':
          return generateDoubleEliminationConfig(participantCount);
        case 'round_robin':
          return generateRoundRobinConfig(participantCount);
        default:
          return generateGenericFormatConfig(format, participantCount);
      }
    }

    function createMatchTable(tableConfig, participants, stageIndex, tableIndex) {
      const tableId = `stage-${stageIndex}-table-${tableIndex}`;
      let html = `<div class="match-table-container">`;
      html += `<div class="match-table-header">`;
      html += `<h5><i class="fas fa-list"></i> ${tableConfig.name}</h5>`;

      // Calculate balanced team distribution across groups
      const kpSettings = tournamentData.kpSettings || {};
      const numberOfGroups = kpSettings.numberOfGroups || 4;
      const totalParticipants = participants.length;
      
      // Calculate balanced distribution
      // Example: 97 teams, 4 groups -> base=24, extra=1 -> [25,24,24,24]
      // Example: 96 teams, 4 groups -> base=24, extra=0 -> [24,24,24,24]
      const baseTeamsPerGroup = Math.floor(totalParticipants / numberOfGroups);
      const extraTeams = totalParticipants % numberOfGroups;
      
      // Calculate this group's size and start/end indices
      let currentGroupSize, startIndex;
      if (tableIndex < extraTeams) {
        // First 'extraTeams' groups get one extra team
        currentGroupSize = baseTeamsPerGroup + 1;
        startIndex = tableIndex * currentGroupSize;
      } else {
        // Remaining groups get base amount
        currentGroupSize = baseTeamsPerGroup;
        startIndex = (extraTeams * (baseTeamsPerGroup + 1)) + ((tableIndex - extraTeams) * baseTeamsPerGroup);
      }
      
      const endIndex = startIndex + currentGroupSize;
      const qualifierTeams = participants.slice(startIndex, endIndex);

      html += `<div class="match-header-controls">`;

      if (tableConfig.type === 'qualifier') {
        html += `<span class="match-count">${qualifierTeams.length}/${currentGroupSize} Teams</span>`;
      } else {
        html += `<span class="match-count">${tableConfig.totalMatches} ${tableConfig.totalMatches === 1 ? 'Match' : 'Matches'}</span>`;
      }

      // Display existing schedule if available (read-only)
      const existingSchedule = getMatchSchedule(tableId);
      if (existingSchedule) {
        html += `<span class="match-schedule">${existingSchedule}</span>`;
      }

      html += `</div>`;
      html += `</div>`;

      // Start Table
      html += `<table class="match-table" id="${tableId}">`;

      // Build table based on type
      if (tableConfig.type === 'qualifier') {
        html += `<thead><tr><th>S.No</th><th>Team Name</th><th>S.No</th><th>Team Name</th></tr></thead>`;
        html += `<tbody>`;

        // Create slots for this qualifier with 2 teams per row
        const maxRows = Math.ceil(currentGroupSize / 2);
        for (let row = 0; row < maxRows; row++) {
          html += `<tr>`;
          
          // First team (left side)
          const slot1 = (row * 2) + 1;
          const team1 = qualifierTeams[slot1 - 1];
          html += `<td class="match-number">${slot1}</td>`;
          if (team1) {
            html += `<td class="match-teams"><strong>${team1.teamName || 'Unnamed Team'}</strong></td>`;
          } else {
            html += `<td class="match-teams"><em>Open Slot</em></td>`;
          }
          
          // Second team (right side)
          const slot2 = (row * 2) + 2;
          if (slot2 <= currentGroupSize) {
            const team2 = qualifierTeams[slot2 - 1];
            html += `<td class="match-number">${slot2}</td>`;
            if (team2) {
              html += `<td class="match-teams"><strong>${team2.teamName || 'Unnamed Team'}</strong></td>`;
            } else {
              html += `<td class="match-teams"><em>Open Slot</em></td>`;
            }
          } else {
            // Empty cells for the last row if odd number of teams
            html += `<td class="match-number"></td>`;
            html += `<td class="match-teams"></td>`;
          }
          
          html += `</tr>`;
        }
        html += `</tbody>`;
      } else if (tableConfig.type === 'final') {
        html += `<thead><tr><th>S.No</th><th>Team Name</th><th>S.No</th><th>Team Name</th></tr></thead>`;
        html += `<tbody>`;

        // Check if we have finalists data
        const finalists = tournamentData.finalists || [];
        const numberOfGroups = kpSettings.numberOfGroups || 4;
        const qualifiersPerGroup = kpSettings.qualifiersPerGroup || 4;
        const totalFinalists = numberOfGroups * qualifiersPerGroup; // 16 teams

        // Create rows with 2 teams per row (4 columns total)
        for (let i = 0; i < totalFinalists; i += 2) {
          html += `<tr>`;

          // First team (left side)
          const team1 = finalists[i];
          html += `<td class="match-number">${i + 1}</td>`;
          html += `<td class="match-teams">${team1 ? (team1.teamName || team1.name || 'Unnamed Team') : '<em>TBD</em>'}</td>`;

          // Second team (right side)
          const team2 = finalists[i + 1];
          html += `<td class="match-number">${i + 2}</td>`;
          html += `<td class="match-teams">${team2 ? (team2.teamName || team2.name || 'Unnamed Team') : '<em>TBD</em>'}</td>`;

          html += `</tr>`;
        }
        html += `</tbody>`;
      }

      html += `</table></div>`;
      return html;
    }

    function generateKPFormatConfig(kpSettings, matchSchedule, participantCount) {
      const groupSize = kpSettings.groupSize || 25;
      const numberOfGroups = kpSettings.numberOfGroups || 4;
      const qualifiersPerGroup = kpSettings.qualifiersPerGroup || 4;

      const qualifierTables = [];

      // Generate qualifier tables based on match schedule from backend
      if (matchSchedule.length > 0) {
        matchSchedule.forEach((match, index) => {
          if (match.match && match.match.includes('Qualifier')) {
            qualifierTables.push({
              name: match.match,
              type: 'qualifier',
              teamsPerMatch: groupSize,
              totalMatches: 1,
              date: match.date,
              teams: match.teams || `${groupSize} teams competing`
            });
          }
        });
      } else {
        // Fallback if no match schedule
        for (let i = 1; i <= numberOfGroups; i++) {
          qualifierTables.push({
            name: `Qualifier Match ${i}`,
            type: 'qualifier',
            teamsPerMatch: groupSize,
            totalMatches: 1,
            teams: `${groupSize} teams competing`
          });
        }
      }

      // Add final match
      const finalMatch = matchSchedule.find(match => match.match && match.match.includes('Final'));
      const finalTable = {
        name: finalMatch ? finalMatch.match : 'Final Match',
        type: 'final',
        teamsPerMatch: numberOfGroups * qualifiersPerGroup,
        totalMatches: 1,
        date: finalMatch ? finalMatch.date : 'TBD',
        teams: `Top ${numberOfGroups * qualifiersPerGroup} Qualifiers`
      };

      return {
        title: 'KP Format Tournament',
        description: `The top 4 of each qualification match will advance to the finals to determine the 16 finalists.`,
        stages: [
          {
            name: 'Qualifier Matches',
            description: `The top 4 of each qualification match will advance to the finals to determine the 16 finalists.`,
            tables: qualifierTables
          },
          {
            name: 'Finalists',
            description: `Top ${numberOfGroups * qualifiersPerGroup} teams compete for championship`,
            tables: [finalTable]
          }
        ]
      };
    }

    function generateSingleEliminationConfig(participantCount) {
      return {
        title: 'Single Elimination Tournament',
        description: 'Teams are eliminated after one loss. Winner advances through each round.',
        stages: [
          {
            name: 'Elimination Rounds',
            description: 'Single elimination bracket progression',
            tables: [
              {
                name: 'Main Bracket',
                type: 'elimination',
                teamsPerMatch: 2,
                totalMatches: Math.max(0, participantCount - 1)
              }
            ]
          }
        ]
      };
    }

    function generateDoubleEliminationConfig(participantCount) {
      return {
        title: 'Double Elimination Tournament',
        description: 'Teams must lose twice to be eliminated. Winners and losers brackets.',
        stages: [
          {
            name: 'Winners Bracket',
            description: 'Main elimination bracket for undefeated teams',
            tables: [
              { name: 'Winners Bracket', type: 'winners', teamsPerMatch: 2, totalMatches: Math.max(0, participantCount - 1) }
            ]
          },
          {
            name: 'Losers Bracket',
            description: 'Second chance bracket for eliminated teams',
            tables: [
              { name: 'Losers Bracket', type: 'losers', teamsPerMatch: 2, totalMatches: Math.max(0, participantCount - 2) }
            ]
          }
        ]
      };
    }

    function generateRoundRobinConfig(participantCount) {
      return {
        title: 'Round Robin Tournament',
        description: 'Every team plays every other team once.',
        stages: [
          {
            name: 'Round Robin Matches',
            description: 'All teams play against each other',
            tables: [
              { name: 'Round Robin', type: 'round_robin', teamsPerMatch: 2, totalMatches: (participantCount * (participantCount - 1)) / 2 }
            ]
          }
        ]
      };
    }

    function generateGenericFormatConfig(format, participantCount) {
      return {
        title: `${format.charAt(0).toUpperCase() + format.slice(1)} Tournament`,
        description: `Tournament using ${format} format.`,
        stages: [
          {
            name: 'Tournament Matches',
            description: 'Tournament progression matches',
            tables: [
              { name: 'Main Tournament', type: 'generic', teamsPerMatch: participantCount, totalMatches: 1 }
            ]
          }
        ]
      };
    }

    function displaySingleEliminationBrackets(participants, container) {
      const numTeams = participants.length;
      const numRounds = Math.ceil(Math.log2(numTeams));

      // Generate matches data for all rounds
      matchesData = generateSingleEliminationMatches(participants, numRounds);

      let html = `<h3>Single Elimination Tournament Structure</h3>`;

      // Visual bracket overview
      html += '<div class="rounds-container">';
      for (let round = 1; round <= numRounds; round++) {
        const matchesInRound = Math.pow(2, numRounds - round);
        html += `<div class="bracket-round">`;
        html += `<div class="round-title">`;

        if (round === numRounds) {
          html += 'Final';
        } else if (round === numRounds - 1) {
          html += 'Semi-Final';
        } else if (round === numRounds - 2) {
          html += 'Quarter-Final';
        } else {
          html += `Round ${round}`;
        }

        html += `</div>`;

        for (let match = 0; match < matchesInRound; match++) {
          const matchData = matchesData.find(m => m.round === round && m.matchInRound === match + 1);
          html += `<div class="bracket-match">`;

          if (matchData) {
            html += `<div class="match-teams">`;
            html += `<div class="team">
                            <span class="team-name">${matchData.team1 || 'TBD'}</span>
                            ${matchData.team1 ? `<span class="seed-number">#${matchData.seed1}</span>` : ''}
                        </div>`;
            html += `<div class="team">
                            <span class="team-name">${matchData.team2 || 'TBD'}</span>
                            ${matchData.team2 ? `<span class="seed-number">#${matchData.seed2}</span>` : ''}
                        </div>`;
            html += `</div>`;
            html += `<div class="match-status">${matchData.status}</div>`;
          }

          html += `</div>`;
        }

        html += `</div>`;
      }
      html += '</div>';

      // Detailed match tables for each round
      html += '<div class="matches-section">';
      html += '<h3>Detailed Match Schedule</h3>';

      for (let round = 1; round <= numRounds; round++) {
        const roundMatches = matchesData.filter(m => m.round === round);
        if (roundMatches.length === 0) continue;

        html += `<div class="round-section">`;
        html += `<div class="round-header">`;

        if (round === numRounds) {
          html += `<i class="fas fa-trophy"></i> Final Match`;
        } else if (round === numRounds - 1) {
          html += `<i class="fas fa-medal"></i> Semi-Final Matches`;
        } else if (round === numRounds - 2) {
          html += `<i class="fas fa-star"></i> Quarter-Final Matches`;
        } else {
          html += `<i class="fas fa-play"></i> Round ${round} Matches`;
        }

        html += `</div>`;

        html += `<table class="match-table">`;
        html += `<thead>
                    <tr>
                        <th>Match #</th>
                        <th>Team 1</th>
                        <th>vs</th>
                        <th>Team 2</th>
                    </tr>
                </thead>
                <tbody>`;

        roundMatches.forEach(match => {
          html += `<tr>
                        <td><span class="match-number">M${match.matchId}</span></td>
                        <td>${match.team1 || 'TBD'} ${match.team1 ? `<span class="seed-number">#${match.seed1}</span>` : ''}</td>
                        <td><span class="vs-separator">VS</span></td>
                        <td>${match.team2 || 'TBD'} ${match.team2 ? `<span class="seed-number">#${match.seed2}</span>` : ''}</td>

                    </tr>`;
        });

        html += `</tbody></table>`;
        html += `</div>`;
      }

      html += '</div>';
      container.innerHTML = html;
    }

    function generateSingleEliminationMatches(participants, numRounds) {
      const matches = [];
      let matchId = 1;

      for (let round = 1; round <= numRounds; round++) {
        const matchesInRound = Math.pow(2, numRounds - round);

        for (let matchInRound = 1; matchInRound <= matchesInRound; matchInRound++) {
          let team1 = null, team2 = null, seed1 = null, seed2 = null;
          let status = 'Scheduled';
          let winnerAdvancesTo = '';

          if (round === 1) {
            // First round - assign actual teams
            const team1Index = (matchInRound - 1) * 2;
            const team2Index = (matchInRound - 1) * 2 + 1;

            if (participants[team1Index]) {
              team1 = participants[team1Index].teamName;
              seed1 = team1Index + 1;
            }
            if (participants[team2Index]) {
              team2 = participants[team2Index].teamName;
              seed2 = team2Index + 1;
            }

            if (!team1 && !team2) {
              status = 'No Teams';
            } else if (!team1 || !team2) {
              status = 'Bye';
            }
          } else {
            status = 'Awaiting Previous Round';
          }

          // Determine where winner advances
          if (round === numRounds) {
            winnerAdvancesTo = 'Tournament Champion';
          } else if (round === numRounds - 1) {
            winnerAdvancesTo = 'Final';
          } else if (round === numRounds - 2) {
            winnerAdvancesTo = 'Semi-Final';
          } else {
            winnerAdvancesTo = `Round ${round + 1}`;
          }

          matches.push({
            matchId: matchId++,
            round: round,
            matchInRound: matchInRound,
            team1: team1,
            team2: team2,
            seed1: seed1,
            seed2: seed2,
            status: status,
            scheduledTime: 'TBD',
            winnerAdvancesTo: winnerAdvancesTo
          });
        }
      }

      return matches;
    }

    function displayDoubleEliminationBrackets(participants, container) {
      container.innerHTML = `
                <div class="no-brackets">
                    <i class="fas fa-construction" style="font-size: 3rem; margin-bottom: 1rem; color: #ffc107;"></i>
                    <h3>Double Elimination Brackets</h3>
                    <p>Double elimination bracket view is under development.</p>
                    <div style="margin-top: 2rem;">
                        <h4>Registered Teams (${participants.length}):</h4>
                        <div class="participants-grid">
                            ${participants.map((p, i) => `
                                <div class="participant-card">
                                    <h4>${p.teamName}</h4>
                                    
                                    <p><strong>Players:</strong> ${p.players ? p.players.length : 0}</p>
                                    <span class="seed-number">Seed #${i + 1}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
    }

    function displayRoundRobinBrackets(participants, container) {
      container.innerHTML = `
                <div class="no-brackets">
                    <i class="fas fa-table" style="font-size: 3rem; margin-bottom: 1rem; color: #17a2b8;"></i>
                    <h3>Round Robin Format</h3>
                    <p>In round robin, every team plays every other team once.</p>
                    <p><strong>Total matches needed:</strong> ${(participants.length * (participants.length - 1)) / 2}</p>
                    <div style="margin-top: 2rem;">
                        <h4>Registered Teams (${participants.length}):</h4>
                        <div class="participants-grid">
                            ${participants.map((p, i) => `
                                <div class="participant-card">
                                    <h4>${p.teamName}</h4>
                                    
                                    <p><strong>Players:</strong> ${p.players ? p.players.length : 0}</p>
                                    <span class="seed-number">Team #${i + 1}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
    }

    function displaySwissBrackets(participants, container) {
      container.innerHTML = `
                <div class="no-brackets">
                    <i class="fas fa-chess" style="font-size: 3rem; margin-bottom: 1rem; color: #6f42c1;"></i>
                    <h3>Swiss System Format</h3>
                    <p>Teams are paired based on their current standings each round.</p>
                    <div style="margin-top: 2rem;">
                        <h4>Registered Teams (${participants.length}):</h4>
                        <div class="participants-grid">
                            ${participants.map((p, i) => `
                                <div class="participant-card">
                                    <h4>${p.teamName}</h4>
                                    
                                    <p><strong>Players:</strong> ${p.players ? p.players.length : 0}</p>
                                    <span class="seed-number">Team #${i + 1}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
    }

    function displayParticipantsList(participants, container) {
      container.innerHTML = `
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h3>Tournament Participants</h3>
                    <p>Bracket structure will be determined based on tournament format.</p>
                </div>
                <div class="participants-grid">
                    ${participants.map((p, i) => `
                        <div class="participant-card">
                            <h4>${p.teamName}</h4>
                            
                            <p><strong>Players:</strong> ${p.players ? p.players.length : 0}</p>
                            <p><strong>Registration:</strong> ${new Date(p.registrationDate).toLocaleDateString()}</p>
                            <p><strong>Payment:</strong> ${p.paymentStatus || 'Pending'}</p>
                            <span class="seed-number">Team #${i + 1}</span>
                        </div>
                    `).join('')}
                </div>
            `;
    }

    async function checkAdminAccess() {
      try {
        // Get auth token from cookies
        const authToken = getCookie('auth_token');
        if (!authToken) {
          return false;
        }

        // Check user role with the backend
        const response = await fetch(`${API_BASE_URL}/api/auth/me`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${authToken}`,
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          return false;
        }

        const userData = await response.json();
        return userData.role === 'admin';
      } catch (error) {
        console.error('Error checking admin access:', error);
        return false;
      }
    }

    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
      return null;
    }



    // Read-only schedule functions for user view

    function getMatchSchedule(tableId) {
      // Get from localStorage first (for immediate display)
      const localSchedule = localStorage.getItem(`schedule_${tableId}`);
      if (localSchedule) return localSchedule;

      // Get from tournament data if available
      if (tournamentData && tournamentData.matchSchedules && tournamentData.matchSchedules[tableId]) {
        return tournamentData.matchSchedules[tableId];
      }

      return null;
    }



    // Load schedules from backend when tournament data is loaded (read-only)
    function loadMatchSchedules() {
      if (tournamentData && tournamentData.matchSchedules) {
        Object.keys(tournamentData.matchSchedules).forEach(tableId => {
          const schedule = tournamentData.matchSchedules[tableId];
          // Schedules are displayed directly in createMatchTable function
        });
      }
    }

    // Call loadMatchSchedules after tournament data is loaded
    const originalLoadTournamentBrackets = loadTournamentBrackets;
    loadTournamentBrackets = async function () {
      await originalLoadTournamentBrackets();
      // Small delay to ensure DOM is updated
      setTimeout(loadMatchSchedules, 100);
    };



    // Carousel navigation
    let currentSlide = 0;
    let totalSlides = 0;

    // Initialize carousel after DOM is loaded
    function initializeCarousel() {
      const slides = document.querySelectorAll('.carousel-slide');
      totalSlides = slides.length;
      if (totalSlides > 0) {
        updateCarousel();
      }
    }

    function nextSlide() {
      if (currentSlide < totalSlides - 1) {
        currentSlide++;
        updateCarousel();
      }
    }

    function previousSlide() {
      if (currentSlide > 0) {
        currentSlide--;
        updateCarousel();
      }
    }

    function updateCarousel() {
      const carouselSlides = document.getElementById('carousel-slides');
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');
      const indicator = document.getElementById('slide-indicator');
      
      if (carouselSlides) {
        carouselSlides.style.transform = `translateX(-${currentSlide * 100}%)`;
      }
      
      // Update button states
      if (prevBtn) prevBtn.disabled = currentSlide === 0;
      if (nextBtn) nextBtn.disabled = currentSlide === totalSlides - 1;
      
      // Update indicator
      if (indicator) indicator.textContent = `Match ${currentSlide + 1} of ${totalSlides}`;
    }

    // Call initializeCarousel after brackets are loaded
    const originalDisplayBrackets = displayBrackets;
    displayBrackets = function() {
      originalDisplayBrackets();
      setTimeout(initializeCarousel, 100);
    };
    // =========================
  // SESSION & NAVBAR MANAGEMENT
  // =========================
  
     // Consolidated session function
    function getSessionData() {
        const session = localStorage.getItem('nexus_session') || sessionStorage.getItem('nexus_session');
        if (!session) return null;
        try {
            const parsedSession = JSON.parse(session);
            if (parsedSession && parsedSession.token && parsedSession.user) {
                return parsedSession;
            }
            return null;
        } catch (error) {
            console.error('Error parsing session data:', error);
            localStorage.removeItem('nexus_session');
            sessionStorage.removeItem('nexus_session');
            return null;
        }
    }

    function checkUserAuthentication() {
        const sessionData = getSessionData();
        const guestMenu = document.getElementById('guest-menu');
        const userMenu = document.getElementById('user-menu');
        const user = sessionData?.user;

        if (user) {
            const username = user.username || (user.email ? user.email.split('@')[0] : 'User');
            const userInitials = username.substring(0, 2).toUpperCase();

            const navbarUsername = document.getElementById('navbar-username');
            const userAvatar = document.getElementById('user-avatar');

            if (navbarUsername) navbarUsername.textContent = username;
            if (userAvatar) userAvatar.textContent = userInitials;

            if (guestMenu) guestMenu.style.display = 'none';
            if (userMenu) userMenu.style.display = 'flex';
        } else {
            if (guestMenu) guestMenu.style.display = 'block';
            if (userMenu) userMenu.style.display = 'none';
        }
    }

    function initializeMobileMenu() {
        const normalMenuToggle = document.getElementById('normalMenuToggle');
        const normalNav = document.getElementById('normalNav');

        if (normalMenuToggle && normalNav) {
            normalMenuToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                normalMenuToggle.classList.toggle('active');
                normalNav.classList.toggle('active');
            });

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.nav-normal') && normalNav.classList.contains('active')) {
                    normalNav.classList.remove('active');
                    normalMenuToggle.classList.remove('active');
                }
            });
        }
    }

    function handleLogout() {
        if (confirm('Are you sure you want to logout?')) {
            localStorage.removeItem('nexus_session');
            sessionStorage.removeItem('nexus_session');
            window.location.href = 'auth.html';
        }
    }

    function redirectToAuth(tab = 'register') {
        const returnUrl = encodeURIComponent(window.location.href);
        window.location.href = `auth.html?tab=${tab}&returnUrl=${returnUrl}`;
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
        checkUserAuthentication();
        initializeMobileMenu();
        
    });
    // Add to DOMContentLoaded or after navbar initialization
    document.querySelectorAll('.nav-links a').forEach(link => {
        if (link.href === window.location.href) {
            link.classList.add('active');
        }
    });
  </script>

</body>

</html>