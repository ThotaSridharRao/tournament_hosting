<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EArena System Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #0f0f10;
            color: #e6e6e6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #1f1f20;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-family: monospace;
        }
        .success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            color: #10b981;
        }
        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            color: #ef4444;
        }
        .info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid #3b82f6;
            color: #3b82f6;
        }
        .warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid #f59e0b;
            color: #f59e0b;
        }
        button {
            background: #FFD700;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
        }
        button:hover {
            background: #e0ac10;
        }
        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online { background: #10b981; }
        .status-offline { background: #ef4444; }
        .status-unknown { background: #6b7280; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ EArena System Test Dashboard</h1>
        
        <div class="test-section">
            <h2>üîß System Status</h2>
            <div id="system-status">
                <div><span class="status-indicator status-unknown"></span>Backend API: <span id="backend-status">Checking...</span></div>
                <div><span class="status-indicator status-unknown"></span>Frontend Server: <span id="frontend-status">Checking...</span></div>
                <div><span class="status-indicator status-unknown"></span>Database: <span id="database-status">Checking...</span></div>
            </div>
        </div>

        <div class="test-section">
            <h2>üåê API Connectivity Tests</h2>
            <button onclick="testAllAPIs()">Run All API Tests</button>
            <button onclick="clearResults()">Clear Results</button>
            <div id="api-results"></div>
        </div>

        <div class="test-section">
            <h2>üîê Authentication Tests</h2>
            <button onclick="testAuthentication()">Test Auth Flow</button>
            <div id="auth-results"></div>
        </div>

        <div class="test-section">
            <h2>üèÜ Tournament Tests</h2>
            <button onclick="testTournaments()">Test Tournament APIs</button>
            <div id="tournament-results"></div>
        </div>

        <div class="test-section">
            <h2>üìä Performance Tests</h2>
            <button onclick="testPerformance()">Test Load Times</button>
            <div id="performance-results"></div>
        </div>

        <div class="test-section">
            <h2>üîó Navigation Tests</h2>
            <button onclick="testNavigation()">Test Page Links</button>
            <div id="navigation-results"></div>
        </div>
    </div>

    <script>
        // Auto-detect API URL
        const isLocal = window.location.hostname === 'localhost' || 
                       window.location.hostname === '127.0.0.1' || 
                       window.location.protocol === 'file:';
        
        const API_BASE_URL = isLocal ? 'http://localhost:8000' : 'https://tournament-hosting-backend.onrender.com';
        
        function addResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(result);
            container.scrollTop = container.scrollHeight;
        }

        function clearResults() {
            ['api-results', 'auth-results', 'tournament-results', 'performance-results', 'navigation-results'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
        }

        async function checkSystemStatus() {
            // Check backend
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    document.getElementById('backend-status').textContent = 'Online';
                    document.querySelector('#system-status div:nth-child(1) .status-indicator').className = 'status-indicator status-online';
                } else {
                    throw new Error('Backend not responding');
                }
            } catch (error) {
                document.getElementById('backend-status').textContent = 'Offline';
                document.querySelector('#system-status div:nth-child(1) .status-indicator').className = 'status-indicator status-offline';
            }

            // Check frontend
            document.getElementById('frontend-status').textContent = 'Online (You\'re viewing this page)';
            document.querySelector('#system-status div:nth-child(2) .status-indicator').className = 'status-indicator status-online';

            // Check database (via API)
            try {
                const response = await fetch(`${API_BASE_URL}/api/tournaments`);
                if (response.ok) {
                    document.getElementById('database-status').textContent = 'Connected';
                    document.querySelector('#system-status div:nth-child(3) .status-indicator').className = 'status-indicator status-online';
                } else {
                    throw new Error('Database not accessible');
                }
            } catch (error) {
                document.getElementById('database-status').textContent = 'Disconnected';
                document.querySelector('#system-status div:nth-child(3) .status-indicator').className = 'status-indicator status-offline';
            }
        }

        async function testAllAPIs() {
            addResult('api-results', `Testing API connectivity to: ${API_BASE_URL}`, 'info');
            
            const endpoints = [
                { path: '/health', method: 'GET', name: 'Health Check' },
                { path: '/api', method: 'GET', name: 'API Info' },
                { path: '/api/tournaments', method: 'GET', name: 'Tournaments List' },
            ];

            for (const endpoint of endpoints) {
                try {
                    const startTime = performance.now();
                    const response = await fetch(`${API_BASE_URL}${endpoint.path}`, {
                        method: endpoint.method
                    });
                    const endTime = performance.now();
                    const duration = Math.round(endTime - startTime);

                    if (response.ok) {
                        const data = await response.json();
                        addResult('api-results', `‚úÖ ${endpoint.name}: ${response.status} (${duration}ms)`, 'success');
                    } else {
                        addResult('api-results', `‚ùå ${endpoint.name}: ${response.status} ${response.statusText}`, 'error');
                    }
                } catch (error) {
                    addResult('api-results', `‚ùå ${endpoint.name}: ${error.message}`, 'error');
                }
            }
        }

        async function testAuthentication() {
            addResult('auth-results', 'Testing authentication flow...', 'info');
            
            const testUser = {
                username: 'testuser' + Date.now(),
                email: 'test' + Date.now() + '@example.com',
                password: 'testpass123'
            };

            try {
                // Test registration
                addResult('auth-results', 'Testing user registration...', 'info');
                const registerResponse = await fetch(`${API_BASE_URL}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testUser)
                });

                if (registerResponse.ok) {
                    const registerData = await registerResponse.json();
                    addResult('auth-results', '‚úÖ Registration successful', 'success');
                    
                    // Test login
                    addResult('auth-results', 'Testing user login...', 'info');
                    const loginResponse = await fetch(`${API_BASE_URL}/api/auth/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            email: testUser.email,
                            password: testUser.password
                        })
                    });

                    if (loginResponse.ok) {
                        const loginData = await loginResponse.json();
                        addResult('auth-results', '‚úÖ Login successful', 'success');
                        addResult('auth-results', `Token received: ${loginData.data.token ? 'Yes' : 'No'}`, 'info');
                        
                        // Test logout
                        const logoutResponse = await fetch(`${API_BASE_URL}/api/auth/logout`, {
                            method: 'POST',
                            headers: { 
                                'Authorization': `Bearer ${loginData.data.token}`,
                                'Content-Type': 'application/json'
                            }
                        });

                        if (logoutResponse.ok) {
                            addResult('auth-results', '‚úÖ Logout successful', 'success');
                        } else {
                            addResult('auth-results', '‚ö†Ô∏è Logout failed (but this is optional)', 'warning');
                        }
                    } else {
                        addResult('auth-results', '‚ùå Login failed', 'error');
                    }
                } else {
                    const errorData = await registerResponse.json();
                    addResult('auth-results', `‚ùå Registration failed: ${errorData.error}`, 'error');
                }
            } catch (error) {
                addResult('auth-results', `‚ùå Auth test error: ${error.message}`, 'error');
            }
        }

        async function testTournaments() {
            addResult('tournament-results', 'Testing tournament functionality...', 'info');
            
            try {
                // Test tournament list
                const tournamentsResponse = await fetch(`${API_BASE_URL}/api/tournaments`);
                if (tournamentsResponse.ok) {
                    const tournamentsData = await tournamentsResponse.json();
                    addResult('tournament-results', `‚úÖ Tournaments loaded: ${tournamentsData.data.length} found`, 'success');
                    
                    if (tournamentsData.data.length > 0) {
                        const tournament = tournamentsData.data[0];
                        addResult('tournament-results', `Sample tournament: ${tournament.title}`, 'info');
                        
                        // Test tournament details
                        if (tournament.slug) {
                            const detailResponse = await fetch(`${API_BASE_URL}/api/tournaments/slug/${tournament.slug}`);
                            if (detailResponse.ok) {
                                addResult('tournament-results', '‚úÖ Tournament details loaded', 'success');
                            } else {
                                addResult('tournament-results', '‚ùå Tournament details failed', 'error');
                            }
                        }
                    }
                } else {
                    addResult('tournament-results', '‚ùå Failed to load tournaments', 'error');
                }
            } catch (error) {
                addResult('tournament-results', `‚ùå Tournament test error: ${error.message}`, 'error');
            }
        }

        async function testPerformance() {
            addResult('performance-results', 'Testing performance...', 'info');
            
            const tests = [
                { name: 'API Response Time', url: `${API_BASE_URL}/api/tournaments` },
                { name: 'Health Check Time', url: `${API_BASE_URL}/health` }
            ];

            for (const test of tests) {
                try {
                    const startTime = performance.now();
                    const response = await fetch(test.url);
                    const endTime = performance.now();
                    const duration = Math.round(endTime - startTime);

                    if (response.ok) {
                        const status = duration < 500 ? 'success' : duration < 1000 ? 'warning' : 'error';
                        const emoji = duration < 500 ? 'üöÄ' : duration < 1000 ? '‚ö°' : 'üêå';
                        addResult('performance-results', `${emoji} ${test.name}: ${duration}ms`, status);
                    }
                } catch (error) {
                    addResult('performance-results', `‚ùå ${test.name}: Failed`, 'error');
                }
            }
        }

        async function testNavigation() {
            addResult('navigation-results', 'Testing page navigation...', 'info');
            
            const pages = [
                'index.html',
                'tournaments.html',
                'auth.html',
                'tournament-details.html',
                'admin-dashboard.html',
                'user-dashboard.html'
            ];

            for (const page of pages) {
                try {
                    const response = await fetch(page);
                    if (response.ok) {
                        addResult('navigation-results', `‚úÖ ${page}: Accessible`, 'success');
                    } else {
                        addResult('navigation-results', `‚ùå ${page}: ${response.status}`, 'error');
                    }
                } catch (error) {
                    addResult('navigation-results', `‚ùå ${page}: ${error.message}`, 'error');
                }
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkSystemStatus();
            addResult('api-results', `Environment detected: ${isLocal ? 'Local Development' : 'Production'}`, 'info');
            addResult('api-results', `API Base URL: ${API_BASE_URL}`, 'info');
        });
    </script>
</body>
</html>