<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title">Tournament Details | EArena</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity=""
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    /* Theme variables */
    :root {
      --bg: #0f0f10;
      --panel: #1f1f20;
      --muted: #9aa0a6;
      --copy: #e6e6e6;
      --accent: #ff4500; 
      --accent-2: #e65c00; 
      --glass: rgba(255, 255, 255, 0.05);
      --radius: 16px;
      --container: 1200px;
      --ease: 180ms cubic-bezier(.2, .9, .2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, var(--bg), #070707 140%);
      color: var(--copy);
      line-height: 1.45;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .container {
      width: min(94%, var(--container));
      margin: 0 auto;
    }

    /* Header Styles */
    header.site-header {
      position: fixed;
      inset: 0 0 auto 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2rem;
      background: rgba(26, 26, 26, 0.5); 
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 1200;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      height: 60px;
    }
    
    .nav-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .header-cta {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: #fff;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .header-cta:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(255, 69, 0, 0.3);
    }

    /* Main content */
    main {
      margin-top: 60px;
      min-height: calc(100vh - 60px);
    }

    /* Tournament Hero */
    .tournament-hero {
      position: relative;
      height: 70vh;
      min-height: 500px;
      background: linear-gradient(135deg, #1a1a1a, #0f0f0f);
      display: flex;
      align-items: center;
      overflow: hidden;
    }

    .tournament-hero::before {
      content: '';
      position: absolute;
      inset: 0;
      background:
        linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.2)),
        radial-gradient(circle at 30% 40%, rgba(255, 69, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 70% 60%, rgba(255, 69, 0, 0.05) 0%, transparent 50%);
      z-index: 1;
    }

    .hero-content {
      position: relative;
      z-index: 2;
      max-width: 800px;
    }

    .tournament-title {
      font-size: clamp(2.5rem, 5vw, 4rem);
      font-weight: 800;
      margin-bottom: 1rem;
      line-height: 1.1;
    }

    .tournament-subtitle {
      font-size: 1.2rem;
      color: var(--muted);
      margin-bottom: 2rem;
      line-height: 1.5;
    }

    .hero-actions {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: #fff;
      padding: 1rem 2rem;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1rem;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      border: none;
      cursor: pointer;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(255, 69, 0, 0.3);
    }
    
    .btn-primary:disabled {
        background: var(--muted);
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
    }

    /* Tournament Details Section */
    .tournament-details {
      padding: 4rem 0;
    }

    .details-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 3rem;
      margin-top: 2rem;
    }

    .details-main, .info-card {
      background: var(--glass);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius);
      padding: 2.5rem;
    }

    .details-sidebar {
      display: flex;
      flex-direction: column;
      gap: 2.5rem;
    }

    .info-card h3 {
      color: var(--accent);
    }
    
    .info-list { list-style: none; }
    .info-list li { display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    .info-list li:last-child { border-bottom: none; }
    .info-label { color: var(--muted); }
    .info-value { font-weight: 600; }
    
    /* Leaderboard Section */
    .leaderboard-section { padding: 4rem 0; }
    .leaderboard-table {
      background: var(--glass);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius);
      overflow: hidden;
      margin-top: 2rem;
    }
    .leaderboard-header {
      background: rgba(255, 69, 0, 0.1);
      padding: 1rem 1.5rem;
      display: grid;
      grid-template-columns: 60px 1fr 2fr;
      gap: 1rem;
      font-weight: 700;
      color: var(--accent);
      text-transform: uppercase;
    }
    .leaderboard-row {
      padding: 1rem 1.5rem;
      display: grid;
      grid-template-columns: 60px 1fr 2fr;
      gap: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
      align-items: center;
    }
    .leaderboard-row:last-child { border-bottom: none; }
    .leaderboard-row:hover { background: rgba(255, 255, 255, 0.05); }
    .rank.first { color: var(--accent); }
    .team-info { display: flex; align-items: center; gap: 0.75rem; }
    .team-avatar { width: 40px; height: 40px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; color: #000; }

    /* Schedule Section */
    .schedule-section { padding: 4rem 0; }
    .schedule-timeline { margin-top: 2rem; }
    .timeline-item { display: flex; gap: 2rem; padding: 1.5rem 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    .timeline-item:last-child { border-bottom: none; }
    .timeline-date { min-width: 120px; text-align: center; }
    .timeline-day { font-size: 1.1rem; font-weight: 700; color: var(--accent); }
    .timeline-time { font-size: 0.85rem; color: var(--muted); }
    .timeline-content { flex: 1; }
    .timeline-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; }
    .timeline-desc { color: var(--muted); }
    
    /* Section Headers */
    .section-header { text-align: center; margin-bottom: 2rem; }
    .section-title { font-size: clamp(2rem, 4vw, 3rem); font-weight: 800; margin-bottom: 1rem; }
    .section-subtitle { font-size: 1.1rem; color: var(--muted); max-width: 600px; margin: 0 auto; }

    /* NEW: FAQ Section */
    .faq-section {
        padding: 4rem 0;
    }
    .faq-grid {
        max-width: 800px;
        margin: 0 auto;
        text-align: left;
    }
    .faq-item {
        background: var(--glass);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius);
        margin-bottom: 1rem;
    }
    .faq-question {
        width: 100%;
        background: none;
        border: none;
        padding: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        color: var(--copy);
        font-size: 1.1rem;
        font-weight: 600;
        text-align: left;
    }
    .faq-question i {
        transition: transform 0.3s ease;
        color: var(--accent);
    }
    .faq-answer {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
    }
    .faq-answer p {
        color: var(--muted);
        padding: 0 1.5rem 1.5rem 1.5rem;
        margin: 0;
        line-height: 1.7;
    }
    .faq-item.active .faq-answer {
        max-height: 200px; /* Adjust as needed */
    }
    .faq-item.active .faq-question i {
        transform: rotate(45deg);
    }


    /* Footer Styles */
    footer.site-footer {
      padding: 4rem 2rem 2rem;
      background: rgba(10, 10, 10, 0.5);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    .footer-grid {
      max-width: 1200px;
      margin: 0 auto 3rem auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2.5rem;
      text-align: left;
    }
    .footer-column h4 {
      color: var(--copy);
      margin-bottom: 1.5rem;
      font-size: 1.1rem;
      font-weight: 600;
    }
    .footer-column ul {
      list-style: none;
      padding: 0;
    }
    .footer-column ul a, .footer-column p {
      color: var(--muted);
      text-decoration: none;
      transition: color 0.3s ease;
      display: block;
      margin-bottom: 0.75rem;
      font-size: 0.95rem;
    }
    .footer-column ul a:hover {
        color: var(--accent);
    }
    .footer-brand .brand {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        font-weight: 700;
        color: var(--copy);
    }
    .footer-brand p {
      margin-bottom: 1.5rem;
      line-height: 1.7;
    }
    .social-links {
      display: flex;
      gap: 1.5rem;
      margin-top: 1rem;
    }
    .social-links a {
      color: var(--muted);
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }
    .social-links a:hover {
      color: var(--accent);
      transform: translateY(-2px);
    }
    .footer-bottom {
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding-top: 2rem;
      text-align: center;
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    /* Profile Dropdown Styles */
    .profile-dropdown { position: relative; display: flex; align-items: center; }
    .profile-icon { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; color: var(--copy); cursor: pointer; border-radius: 50%; transition: all 0.3s ease; font-size: 1.5rem; }
    .profile-icon:hover { color: var(--accent); background: rgba(255, 69, 0, 0.1); transform: scale(1.1); }
    .profile-modal { position: absolute; top: 100%; right: 0; background: var(--panel); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; min-width: 280px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.3s ease; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5); z-index: 1000; margin-top: 10px; }
    .profile-dropdown:hover .profile-modal { opacity: 1; visibility: visible; transform: translateY(0); }
    .profile-header { display: flex; align-items: center; gap: 1rem; padding: 1.5rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    .profile-photo { width: 50px; height: 50px; background: linear-gradient(135deg, var(--accent), var(--accent-2)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #000; font-size: 1.5rem; flex-shrink: 0; }
    .profile-username { font-weight: 700; font-size: 1.1rem; }
    .profile-actions { padding: 0.5rem; }
    .profile-action { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; text-decoration: none; border-radius: 8px; transition: all 0.3s ease; font-weight: 600; width: 100%; border: none; background: none; cursor: pointer; font-family: inherit; }
    .profile-action:hover { background: rgba(255, 255, 255, 0.05); color: var(--accent); transform: translateX(4px); }
    .logout-action:hover { background: rgba(255, 0, 0, 0.1); color: #ff6b6b; }
    
    @media (max-width: 768px) {
      .details-grid { grid-template-columns: 1fr; }
      .hero-actions { flex-direction: column; }
      .btn-primary { text-align: center; }
      .timeline-item { flex-direction: column; gap: 1rem; }
      .timeline-date { text-align: left; }
    }
  </style>
</head>

<body>
  <header class="site-header">
    <a href="index.html" class="back-btn">
      <i class="fas fa-arrow-left"></i>
      Back to Home
    </a>
    <div class="nav-actions">
      <div id="guest-menu">
        <button class="header-cta" onclick="redirectToAuth()">Join Us</button>
      </div>
      <div id="user-menu" style="display: none;">
        <div class="profile-dropdown">
          <div class="profile-icon" id="profile-icon">
            <i class="fas fa-user-circle"></i>
          </div>
          <div class="profile-modal" id="profile-modal">
            <div class="profile-header">
              <div class="profile-photo"><i class="fas fa-user"></i></div>
              <div class="profile-info">
                <div class="profile-username" id="modal-username">User</div>
              </div>
            </div>
            <div class="profile-actions">
              <a href="user-dashboard.html" class="profile-action" id="modal-dashboard-link">
                <i class="fas fa-user"></i>
                <span>My Account</span>
              </a>
              <button class="profile-action logout-action" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="tournament-hero">
      <div class="container">
        <div class="hero-content">
          <h1 class="tournament-title" id="tournament-title">Loading Tournament...</h1>
          <p class="tournament-subtitle" id="tournament-subtitle">
            Loading tournament details...
          </p>
          <div class="hero-actions" id="hero-actions">
             <button class="btn-primary" id="register-btn">Register</button>
          </div>
        </div>
      </div>
    </section>

    <section class="tournament-details" id="tournament-details-section">
      <div class="container">
        <div class="details-grid">
          <div class="details-main">
            <img id="tournament-poster" alt="Tournament Poster" style="width: 100%; border-radius: var(--radius); margin-bottom: 2rem; display: none;" />
            <div id="tournament-status" style="font-weight: bold; color: var(--accent); margin-bottom: 1rem; text-transform: uppercase;"></div>
            <h2 style="color: var(--accent); margin-bottom: 1.5rem;">Tournament Overview</h2>
            <div id="tournament-overview">
              <p style="color: var(--muted);">Loading details...</p>
            </div>
            <h3 style="color: var(--accent); margin: 2rem 0 1rem 0;">Tournament Format</h3>
            <div id="tournament-format-details">
              <p style="color: var(--muted);">Loading format...</p>
            </div>
          </div>

          <div class="details-sidebar">
            <div class="info-card">
              <h3><i class="fas fa-info-circle"></i> Tournament Info</h3>
              <ul class="info-list">
                <li><span class="info-label">Game</span><span class="info-value" id="game-name">--</span></li>
                <li><span class="info-label">Format</span><span class="info-value" id="tournament-format">--</span></li>
                <li><span class="info-label">Entry Fee</span><span class="info-value" id="entry-fee">--</span></li>
                <li><span class="info-label">Max Teams</span><span class="info-value" id="max-teams">--</span></li>
              </ul>
            </div>
            <div class="info-card">
              <h3><i class="fas fa-calendar"></i> Schedule</h3>
              <ul class="info-list">
                <li><span class="info-label">Reg. Opens</span><span class="info-value" id="reg-start-date">--</span></li>
                <li><span class="info-label">Reg. Closes</span><span class="info-value" id="reg-end-date">--</span></li>
                <li><span class="info-label">Tournament Start</span><span class="info-value" id="tournament-start-date">--</span></li>
                <li><span class="info-label">Tournament End</span><span class="info-value" id="tournament-end-date">--</span></li>
              </ul>
            </div>
            <div class="info-card">
              <h3><i class="fas fa-trophy"></i> Prizes</h3>
              <ul class="info-list" id="prize-list"></ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="leaderboard-section" id="leaderboard-section" style="display: none;">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">Leaderboard</h2>
          <p class="section-subtitle">Current standings based on registered teams.</p>
        </div>
        <div class="leaderboard-table" id="leaderboard-table">
          <div class="leaderboard-header">
            <div>Rank</div>
            <div>Team</div>
            <div>Players</div>
          </div>
          <div id="leaderboard-rows">
            <!-- Populated by JS -->
          </div>
        </div>
      </div>
    </section>

    <section class="schedule-section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">Tournament Schedule</h2>
          <p class="section-subtitle">Complete timeline of matches and events.</p>
        </div>
        <div class="schedule-timeline" id="schedule-timeline"></div>
      </div>
    </section>

    <!-- NEW: FAQ Section -->
    <section class="faq-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Frequently Asked Questions</h2>
            </div>
            <div class="faq-grid">
                <div class="faq-item">
                    <button class="faq-question">
                        <span>What do I need to get started?</span>
                        <i class="fas fa-plus"></i>
                    </button>
                    <div class="faq-answer">
                        <p>All you need is an account and the game you want to compete in! Check the specific tournament rules for any additional requirements, but generally, it's that simple to start your competitive journey.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">
                        <span>How are prizes awarded?</span>
                        <i class="fas fa-plus"></i>
                    </button>
                    <div class="faq-answer">
                        <p>Prizes are typically awarded within 7-14 business days after a tournament concludes and results are verified. Winnings are sent via the payment method you have on file in your user account.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">
                        <span>What is the fair play policy?</span>
                        <i class="fas fa-plus"></i>
                    </button>
                    <div class="faq-answer">
                        <p>We have a zero-tolerance policy for cheating, hacking, or any form of unsportsmanlike conduct. All players must adhere to our code of conduct, and we use advanced anti-cheat software to ensure a fair playing field.</p>
                    </div>
                </div>
                 <div class="faq-item">
                    <button class="faq-question">
                        <span>Can I stream my matches?</span>
                        <i class="fas fa-plus"></i>
                    </button>
                    <div class="faq-answer">
                        <p>Absolutely! We encourage players to stream their matches. Just be sure to check the specific tournament rules, as some events may have restrictions or require a stream delay.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-column footer-brand">
          <a href="index.html" class="brand">EArena</a>
          <p>The ultimate destination for competitive gaming.</p>
           <div class="social-links">
              <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
              <a href="#" aria-label="Discord"><i class="fab fa-discord"></i></a>
              <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
              <a href="#" aria-label="Youtube"><i class="fab fa-youtube"></i></a>
            </div>
        </div>
        <div class="footer-column">
          <h4>Tournaments</h4>
          <ul>
            <li><a href="#">Browse All</a></li>
            <li><a href="#">Live Matches</a></li>
            <li><a href="#">Upcoming</a></li>
            <li><a href="#">Past Results</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h4>Community</h4>
          <ul>
            <li><a href="#">Discord</a></li>
            <li><a href="#">Forums</a></li>
            <li><a href="#">Support</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h4>Company</h4>
          <ul>
            <li><a href="#">About</a></li>
            <li><a href="#">Contact</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 EArena. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    const API_BASE_URL = 'https://t2-237c.onrender.com';
    let currentTournament = null;

    function redirectToAuth(tab = 'register') {
      const returnUrl = encodeURIComponent(window.location.href);
      window.location.href = `auth.html?tab=${tab}&returnUrl=${returnUrl}`;
    }

    function getSessionData() {
      const session = localStorage.getItem('earena_session') || sessionStorage.getItem('earena_session');
      try {
        return session ? JSON.parse(session) : null;
      } catch (error) {
        return null;
      }
    }

    function updateSchedule(tournament) {
        const container = document.getElementById('schedule-timeline');
        if (!container) return;
        let allEvents = [];
        
        allEvents.push({ date: new Date(tournament.registrationStart), title: 'Registration Opens' });
        allEvents.push({ date: new Date(tournament.registrationEnd), title: 'Registration Closes' });
        allEvents.push({ date: new Date(tournament.tournamentStart), title: 'Tournament Begins' });
        allEvents.push({ date: new Date(tournament.tournamentEnd), title: 'Tournament Ends' });

        if (tournament.scheduleEvents) {
            tournament.scheduleEvents.forEach(event => allEvents.push({ date: new Date(`${event.date}T${event.time}`), title: event.title, description: event.description }));
        }
        if (tournament.format === 'kp' && tournament.kpSettings && tournament.kpSettings.matchSchedule) {
            tournament.kpSettings.matchSchedule.forEach(match => allEvents.push({ date: new Date(match.date), title: match.match, description: `${match.teams} teams competing` }));
        }

        allEvents.sort((a, b) => a.date - b.date);

        if (allEvents.length <= 4 && !tournament.scheduleEvents && !(tournament.kpSettings && tournament.kpSettings.matchSchedule)) {
             container.innerHTML = `<div class="empty-schedule" style="text-align:center; padding: 2rem;"><p>No detailed match schedule has been posted yet.</p></div>`;
             return;
        }
        
        container.innerHTML = allEvents.map(event => {
            const day = event.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            const time = event.date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
            return `
                <div class="timeline-item">
                    <div class="timeline-date"><div class="timeline-day">${day}</div><div class="timeline-time">${time}</div></div>
                    <div class="timeline-content">
                        <h3 class="timeline-title">${event.title}</h3>
                        ${event.description ? `<p class="timeline-desc">${event.description}</p>` : ''}
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderLeaderboard(participants) {
        const leaderboardRows = document.getElementById('leaderboard-rows');
        if (!participants || participants.length === 0) {
            leaderboardRows.innerHTML = `<div style="text-align:center; padding: 2rem; color: var(--muted);">No teams have registered yet.</div>`;
            return;
        }
        leaderboardRows.innerHTML = participants.map((team, index) => {
            const rank = index + 1;
            const rankClass = rank === 1 ? 'first' : '';
            const playersList = team.players.map(p => p.name).join(', ');
            return `
                <div class="leaderboard-row">
                    <div class="rank ${rankClass}">#${rank}</div>
                    <div class="team-info">
                        <div class="team-avatar">${team.teamName.charAt(0).toUpperCase()}</div>
                        <div>${team.teamName}</div>
                    </div>
                    <div>${playersList}</div>
                </div>
            `;
        }).join('');
    }

    async function loadTournamentDetails(slug) {
      try {
        const res = await fetch(`${API_BASE_URL}/api/tournaments/slug/${slug}`);
         if (!res.ok) {
            const errorData = await res.json().catch(() => ({ message: `API Error: ${res.status}` }));
            throw new Error(errorData.error || errorData.message);
        }
        const result = await res.json();
        if (!result.success) throw new Error(result.error || 'Failed to fetch tournament');
        
        const tournament = result.data;
        currentTournament = tournament;
        
        // --- Display poster image ---
        const posterImg = document.querySelector("#tournament-poster");
        if (tournament.posterImage) {
            posterImg.src =
            tournament.posterImage.startsWith("http")
              ? tournament.posterImage
              : `${API_BASE_URL}/${tournament.posterImage}`;
            posterImg.style.display = 'block';
        }

        // --- Show tournament status from backend ---
        document.querySelector("#tournament-status").textContent = `Status: ${tournament.status.replace('_', ' ')}`;

        // --- Populate UI Elements ---
        document.getElementById('page-title').textContent = `${tournament.title} | EArena`;
        document.getElementById('tournament-title').textContent = tournament.title;
        document.getElementById('tournament-subtitle').textContent = tournament.description || 'Join this exciting tournament!';
        
        document.getElementById('tournament-overview').innerHTML = `<p>${tournament.description || "No description available."}</p>`;
        
        let formatHTML = '';
        if (tournament.format === 'kp' && tournament.kpSettings) {
            const settings = tournament.kpSettings;
            formatHTML = `
                <p style="margin-bottom: 1rem; line-height: 1.7;">This tournament follows the <strong>Kill Points (KP)</strong> format.</p>
                <ul style="list-style-type: none; padding-left: 0; display: flex; flex-direction: column; gap: 1rem;">
                    <li style="display: flex; align-items: start; gap: 0.75rem;"><i class="fas fa-sitemap" style="color: var(--accent); margin-top: 5px;"></i><div><strong>Structure:</strong> ${settings.numberOfGroups || 'multiple'} qualifier groups.</div></li>
                    <li style="display: flex; align-items: start; gap: 0.75rem;"><i class="fas fa-users" style="color: var(--accent); margin-top: 5px;"></i><div><strong>Groups:</strong> ${settings.groupSize || 'several'} teams per group.</div></li>
                    <li style="display: flex; align-items: start; gap: 0.75rem;"><i class="fas fa-trophy" style="color: var(--accent); margin-top: 5px;"></i><div><strong>Advancement:</strong> Top <strong>${settings.qualifiersPerGroup || 'few'} teams</strong> advance.</div></li>
                </ul>`;
        } else {
            formatHTML = `<p>This tournament features a <strong>${tournament.format ? tournament.format.replace('_', ' ') : 'Standard'}</strong> format.</p>`;
        }
        document.getElementById('tournament-format-details').innerHTML = formatHTML;

        document.getElementById('game-name').textContent = tournament.game || 'TBD';
        document.getElementById('tournament-format').textContent = tournament.format || 'TBD';
        document.getElementById('entry-fee').textContent = tournament.entryFee ? `₹${tournament.entryFee}` : 'Free';
        document.getElementById('max-teams').textContent = tournament.maxTeams || 'Unlimited';

        const formatDate = (dateString) => new Date(dateString).toLocaleDateString('en-IN', { day: 'numeric', month: 'short' });
        document.getElementById('reg-start-date').textContent = formatDate(tournament.registrationStart);
        document.getElementById('reg-end-date').textContent = formatDate(tournament.registrationEnd);
        document.getElementById('tournament-start-date').textContent = formatDate(tournament.tournamentStart);
        document.getElementById('tournament-end-date').textContent = formatDate(tournament.tournamentEnd);

        const prizeList = document.getElementById('prize-list');
        prizeList.innerHTML = '';
        if (tournament.prizeDistribution) {
            Object.entries(tournament.prizeDistribution).forEach(([place, amount]) => {
                prizeList.innerHTML += `<li><span class="info-label">${place.charAt(0).toUpperCase() + place.slice(1)} Place</span><span class="info-value">₹${amount.toLocaleString('en-IN')}</span></li>`;
            });
        }
        
        updateSchedule(tournament);

        // --- Check registration status and update action button ---
        const registerBtn = document.querySelector("#register-btn");
        const session = getSessionData();
        const user = session?.data?.user || session?.user;
        const userId = user?.id;

        let isRegistered = false;
        if (userId && Array.isArray(tournament.participants)) {
          isRegistered = tournament.participants.some(p => p.user_id === userId);
        }

        if (isRegistered) {
          registerBtn.disabled = true;
          registerBtn.textContent = "✅ Already Registered";
          registerBtn.onclick = null;
        } else if (tournament.status === "registration_open") {
          registerBtn.disabled = false;
          registerBtn.textContent = "Register Now";
           registerBtn.onclick = () => {
              if (user) {
                  window.location.href = `team-registration.html?slug=${currentTournament.slug}`;
              } else {
                  redirectToAuth('register');
              }
          };
        } else {
          registerBtn.disabled = true;
          registerBtn.textContent = "Registration Closed";
          registerBtn.onclick = null;
        }
        
        // Show leaderboard if tournament is live or completed
        const leaderboardSection = document.getElementById('leaderboard-section');
        if (tournament.status === 'live' || tournament.status === 'completed') {
            leaderboardSection.style.display = 'block';
            registerBtn.style.display = 'none'; // Hide register button
            renderLeaderboard(tournament.participants || []);
            if (tournament.status === 'completed') {
                leaderboardSection.querySelector('.section-title').textContent = 'Final Results';
            }
        }

      } catch (err) {
        console.error("Error loading tournament:", err);
        document.getElementById('tournament-title').textContent = "Tournament Not Found";
        document.getElementById('tournament-subtitle').textContent = err.message || "The requested tournament could not be loaded.";
        document.getElementById('register-btn').style.display = 'none';
      }
    }
    
    function checkUserAuthentication() {
      const sessionData = getSessionData();
      const guestMenu = document.getElementById('guest-menu');
      const userMenu = document.getElementById('user-menu');
      const user = sessionData?.data?.user || sessionData?.user;

      if (user) {
        document.getElementById('modal-username').textContent = user.username || user.email.split('@')[0];
        guestMenu.style.display = 'none';
        userMenu.style.display = 'flex';
      } else {
        guestMenu.style.display = 'flex';
        userMenu.style.display = 'none';
      }
    }

    function logout() {
      localStorage.removeItem('earena_session');
      sessionStorage.removeItem('earena_session');
      window.location.reload();
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const slug = urlParams.get('slug');
      if (!slug) {
        document.getElementById('tournament-title').textContent = "Tournament Not Found";
        document.getElementById('tournament-subtitle').textContent = "No tournament was specified.";
        return;
      }
      checkUserAuthentication();
      await loadTournamentDetails(slug);
      
      // Initialize FAQ Accordion
      const faqItems = document.querySelectorAll('.faq-item');
      faqItems.forEach(item => {
          const question = item.querySelector('.faq-question');
          question.addEventListener('click', () => {
              const currentlyActive = document.querySelector('.faq-item.active');
              if (currentlyActive && currentlyActive !== item) {
                  currentlyActive.classList.remove('active');
              }
              item.classList.toggle('active');
          });
      });
    });
  </script>
</body>

</html>

