<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organizer Reputation Display</title>
    <style>
        .organizer-reputation {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .reputation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .organizer-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .organizer-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            color: white;
        }

        .organizer-details h3 {
            margin: 0;
            color: #00d4ff;
            font-size: 1.3em;
        }

        .organizer-details .email {
            color: #ccc;
            font-size: 0.9em;
            margin: 5px 0;
        }

        .trust-level {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .trust-level.new {
            background: rgba(128, 128, 128, 0.2);
            color: #ccc;
        }

        .trust-level.bronze {
            background: rgba(205, 127, 50, 0.2);
            color: #CD7F32;
        }

        .trust-level.silver {
            background: rgba(192, 192, 192, 0.2);
            color: #C0C0C0;
        }

        .trust-level.gold {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
        }

        .trust-level.trusted {
            background: rgba(0, 255, 0, 0.2);
            color: #00FF00;
        }

        .reputation-score {
            text-align: center;
            margin-bottom: 20px;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: conic-gradient(#00d4ff 0deg, #00d4ff var(--score-angle), #333 var(--score-angle), #333 360deg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            position: relative;
        }

        .score-circle::before {
            content: '';
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #1a1a1a;
            position: absolute;
        }

        .score-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #00d4ff;
            z-index: 1;
        }

        .score-label {
            color: #ccc;
            font-size: 0.9em;
        }

        .credibility-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .indicator {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: transform 0.2s ease;
        }

        .indicator:hover {
            transform: translateY(-2px);
        }

        .indicator-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .indicator-icon.green {
            background: rgba(0, 255, 0, 0.2);
            color: #00FF00;
        }

        .indicator-icon.blue {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
        }

        .indicator-icon.gold {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
        }

        .indicator-icon.gray {
            background: rgba(128, 128, 128, 0.2);
            color: #ccc;
        }

        .indicator-content {
            flex: 1;
        }

        .indicator-label {
            font-weight: bold;
            color: #00d4ff;
            font-size: 0.9em;
        }

        .indicator-value {
            color: white;
            margin-top: 2px;
        }

        .ratings-summary {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            align-items: center;
        }

        .average-rating {
            text-align: center;
        }

        .rating-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 5px;
        }

        .rating-stars {
            font-size: 1.5em;
            color: #FFD700;
            margin-bottom: 5px;
        }

        .rating-count {
            color: #ccc;
            font-size: 0.9em;
        }

        .rating-breakdown {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .rating-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rating-bar-label {
            width: 20px;
            color: #ccc;
            font-size: 0.9em;
        }

        .rating-bar-fill {
            flex: 1;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
        }

        .rating-bar-progress {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            transition: width 0.3s ease;
        }

        .rating-bar-count {
            width: 30px;
            text-align: right;
            color: #ccc;
            font-size: 0.9em;
        }

        .recent-feedback {
            margin-top: 20px;
        }

        .recent-feedback h4 {
            color: #00d4ff;
            margin-bottom: 15px;
        }

        .feedback-item {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .feedback-rating {
            color: #FFD700;
        }

        .feedback-date {
            color: #ccc;
            font-size: 0.8em;
        }

        .feedback-text {
            color: #ddd;
            line-height: 1.4;
        }

        .view-all-ratings {
            text-align: center;
            margin-top: 15px;
        }

        .view-all-btn {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s ease;
        }

        .view-all-btn:hover {
            transform: translateY(-2px);
        }

        .loading {
            text-align: center;
            color: #00d4ff;
            padding: 40px;
        }

        .error {
            text-align: center;
            color: #ff4444;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .reputation-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .ratings-summary {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .credibility-indicators {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="organizerReputationContainer">
        <!-- This will be populated by JavaScript -->
    </div>

    <script>
        class OrganizerReputationDisplay {
            constructor(containerId) {
                this.container = document.getElementById(containerId);
                this.organizerId = null;
                this.reputationData = null;
            }

            async loadReputation(organizerId) {
                this.organizerId = organizerId;
                this.showLoading();

                try {
                    const response = await fetch(`/api/organizers/${organizerId}/reputation`);
                    const result = await response.json();

                    if (result.success) {
                        this.reputationData = result.data;
                        this.render();
                    } else {
                        this.showError('Failed to load organizer reputation');
                    }
                } catch (error) {
                    console.error('Error loading reputation:', error);
                    this.showError('Failed to load organizer reputation');
                }
            }

            showLoading() {
                this.container.innerHTML = `
                    <div class="organizer-reputation">
                        <div class="loading">Loading organizer reputation...</div>
                    </div>
                `;
            }

            showError(message) {
                this.container.innerHTML = `
                    <div class="organizer-reputation">
                        <div class="error">${message}</div>
                    </div>
                `;
            }

            render() {
                if (!this.reputationData) return;

                const data = this.reputationData;
                const scoreAngle = (data.reputation_score / 1000) * 360;

                this.container.innerHTML = `
                    <div class="organizer-reputation">
                        ${this.renderHeader(data)}
                        ${this.renderReputationScore(data, scoreAngle)}
                        ${this.renderCredibilityIndicators(data)}
                        ${this.renderRatingsSummary(data)}
                        ${this.renderRecentFeedback(data)}
                    </div>
                `;
            }

            renderHeader(data) {
                return `
                    <div class="reputation-header">
                        <div class="organizer-info">
                            <div class="organizer-avatar">
                                ${this.getInitials(data.organizer_username || 'Unknown')}
                            </div>
                            <div class="organizer-details">
                                <h3>${data.organizer_username || 'Unknown Organizer'}</h3>
                                <div class="email">${data.organizer_email || ''}</div>
                            </div>
                        </div>
                        <div class="trust-level ${data.trust_level}">
                            ${this.getTrustLevelIcon(data.trust_level)}
                            ${data.trust_level.charAt(0).toUpperCase() + data.trust_level.slice(1)} Organizer
                        </div>
                    </div>
                `;
            }

            renderReputationScore(data, scoreAngle) {
                return `
                    <div class="reputation-score">
                        <div class="score-circle" style="--score-angle: ${scoreAngle}deg">
                            <div class="score-value">${data.reputation_score}</div>
                        </div>
                        <div class="score-label">Reputation Score</div>
                    </div>
                `;
            }

            renderCredibilityIndicators(data) {
                if (!data.credibility_indicators || data.credibility_indicators.length === 0) {
                    return '';
                }

                const indicators = data.credibility_indicators.map(indicator => `
                    <div class="indicator" title="${indicator.tooltip}">
                        <div class="indicator-icon ${indicator.color}">
                            ${this.getIndicatorIcon(indicator.icon)}
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-label">${indicator.label}</div>
                            <div class="indicator-value">${indicator.value}</div>
                        </div>
                    </div>
                `).join('');

                return `
                    <div class="credibility-indicators">
                        ${indicators}
                    </div>
                `;
            }

            renderRatingsSummary(data) {
                const summary = data.ratings_summary;
                if (!summary || summary.total_ratings === 0) {
                    return `
                        <div class="ratings-summary">
                            <div class="average-rating">
                                <div class="rating-number">-</div>
                                <div class="rating-stars">☆☆☆☆☆</div>
                                <div class="rating-count">No ratings yet</div>
                            </div>
                            <div class="rating-breakdown">
                                <div style="text-align: center; color: #ccc;">
                                    This organizer hasn't received any ratings yet.
                                </div>
                            </div>
                        </div>
                    `;
                }

                const stars = this.renderStars(summary.average_rating);
                const breakdown = this.renderRatingBreakdown(summary.rating_distribution, summary.total_ratings);

                return `
                    <div class="ratings-summary">
                        <div class="average-rating">
                            <div class="rating-number">${summary.average_rating.toFixed(1)}</div>
                            <div class="rating-stars">${stars}</div>
                            <div class="rating-count">${summary.total_ratings} rating${summary.total_ratings !== 1 ? 's' : ''}</div>
                        </div>
                        <div class="rating-breakdown">
                            ${breakdown}
                        </div>
                    </div>
                `;
            }

            renderRecentFeedback(data) {
                const feedback = data.ratings_summary?.recent_feedback;
                if (!feedback || feedback.length === 0) {
                    return '';
                }

                const feedbackItems = feedback.slice(0, 3).map(item => `
                    <div class="feedback-item">
                        <div class="feedback-header">
                            <div class="feedback-rating">${this.renderStars(item.rating)}</div>
                            <div class="feedback-date">${this.formatDate(item.created_at)}</div>
                        </div>
                        <div class="feedback-text">${item.feedback}</div>
                    </div>
                `).join('');

                return `
                    <div class="recent-feedback">
                        <h4>Recent Feedback</h4>
                        ${feedbackItems}
                        ${feedback.length > 3 ? `
                            <div class="view-all-ratings">
                                <button class="view-all-btn" onclick="viewAllRatings('${this.organizerId}')">
                                    View All Ratings
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            renderStars(rating) {
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;
                const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

                return '★'.repeat(fullStars) + 
                       (hasHalfStar ? '☆' : '') + 
                       '☆'.repeat(emptyStars);
            }

            renderRatingBreakdown(distribution, total) {
                return [5, 4, 3, 2, 1].map(rating => {
                    const count = distribution[rating] || 0;
                    const percentage = total > 0 ? (count / total) * 100 : 0;

                    return `
                        <div class="rating-bar">
                            <div class="rating-bar-label">${rating}</div>
                            <div class="rating-bar-fill">
                                <div class="rating-bar-progress" style="width: ${percentage}%"></div>
                            </div>
                            <div class="rating-bar-count">${count}</div>
                        </div>
                    `;
                }).join('');
            }

            getInitials(name) {
                return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
            }

            getTrustLevelIcon(level) {
                const icons = {
                    'new': '🆕',
                    'bronze': '🥉',
                    'silver': '🥈',
                    'gold': '🥇',
                    'trusted': '✅'
                };
                return icons[level] || '🆕';
            }

            getIndicatorIcon(iconType) {
                const icons = {
                    'shield': '🛡️',
                    'trophy': '🏆',
                    'check-circle': '✅',
                    'star': '⭐',
                    'verified': '✅',
                    'experience': '📊',
                    'success': '🎯'
                };
                return icons[iconType] || '📊';
            }

            formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
            }
        }

        // Initialize the reputation display
        const reputationDisplay = new OrganizerReputationDisplay('organizerReputationContainer');

        // Function to load reputation for a specific organizer
        function loadOrganizerReputation(organizerId) {
            reputationDisplay.loadReputation(organizerId);
        }

        // Function to view all ratings (can be implemented as a modal or separate page)
        function viewAllRatings(organizerId) {
            // This could open a modal or navigate to a detailed ratings page
            console.log('View all ratings for organizer:', organizerId);
            // Implementation depends on your app's navigation structure
        }

        // Export functions for use in other pages
        window.loadOrganizerReputation = loadOrganizerReputation;
        window.viewAllRatings = viewAllRatings;

        // Example usage - load reputation for organizer ID from URL or data attribute
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const organizerId = urlParams.get('organizerId');
            
            if (organizerId) {
                loadOrganizerReputation(organizerId);
            }
        });
    </script>
</body>
</html>